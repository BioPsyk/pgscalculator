/*
 * -------------------------------------------------
 *  pgscalculator Nextflow config file
 * -------------------------------------------------
 * Default config options for all environments.
 */

// Set todays date, used to create dated files/folders
today = new Date().format("yyyy-MM-dd-HHmm")

if(params.dev){
  cleanup = false
}else{
  cleanup = true
}

workDir = "/pgscalculator/work"
tmpDir = "/tmp"


// Global default params, used in configs
params {
  
  // dev options
  dev = false

  // pipeline root
  libdir = '/pgscalculator'

  // input
  method="sbayesr"

  // Output 
  // set to =false if you want to suppress the output (not for intermediates)
  // intermediates won't be created unless the --dev flag is activated
  intermediates="${params.outdir}/intermediates"
  details="${params.outdir}/details"
  tracedir="${params.outdir}/pipeline_info"
  

  // Reference folders
  mapfile = "${params.libdir}/assets/sumstats_column_names_map.tsv"
  rsid_ref_37 = "${params.libdir}/references/cleansumstat_rsid_map/sbayesr_band_ukb_10k_hm3/b37"
  rsid_ref_38 = "${params.libdir}/references/cleansumstat_rsid_map/sbayesr_band_ukb_10k_hm3/b38"

  // sbayesr specific
  // set to "" to disable
  calc_posteriors_sbayesr {
    score_columns = "2 5 8"
    gamma = "--gamma 0.0,0.01,0.1,1"
    pi = "--pi 0.95,0.02,0.02,0.01"
    burn_in = "--burn-in 2000"
    chain_length = "--chain-length 10000"
    out_freq = "--out-freq 10"
    p_value = "--p-value 0.99"
    rsq = "--rsq 0.95"
    thread = "--thread 6"
    seed = "--seed 80851"
    unscale_genotype = "--unscale-genotype" 
    exclude_mhc = "--exclude-mhc"
    no_mcmc_bin = "--no-mcmc-bin"
  }

  // prscs specific
  calc_posteriors_prscs {
    score_columns="2 4 6"
  }
}

// Load base.config by default for all pipelines
includeConfig 'conf/base.config'

// Capture exit codes from upstream processes when piping
process.shell = ['/bin/bash', '-euo', 'pipefail']

timeline {
  enabled = true
  file = "${params.tracedir}/execution_timeline.html"
}
report {
  enabled = true
  file = "${params.tracedir}/execution_report.html"
}
trace {
  enabled = true
  file = "${params.tracedir}/execution_trace.txt"
}
dag {
  enabled = true
  file = "${params.tracedir}/pipeline_dag.svg"
}

manifest {
  name = 'pgscalculator'
  author = 'Jesper R. GÃ¥din'
  homePage = 'https://github.com/BioPsyk/pgscalculator'
  description = 'calcualting pgs using different standard tools for pgs'
  mainScript = 'main.nf'
}
